<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Add a heuristic solver — add_heuristic_solver • oppr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Add a heuristic solver — add_heuristic_solver"><meta property="og:description" content="Specify that solutions should be generated using a backwards step-wise
heuristic algorithm (inspired by Cabeza et al. 2004,
Korte &amp;amp; Vygen 2000, Probert et al. 2016). Ideally,
solutions should be generated using exact algorithm solvers (e.g.
add_rsymphony_solver() or add_gurobi_solver())
because they are guaranteed to identify optimal solutions (Rodrigues &amp;amp; Gaston
2002)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oppr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/oppr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/prioritizr/oppr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add a heuristic solver</h1>
    <small class="dont-index">Source: <a href="https://github.com/prioritizr/oppr/blob/HEAD/R/add_heuristic_solver.R" class="external-link"><code>R/add_heuristic_solver.R</code></a></small>
    <div class="hidden name"><code>add_heuristic_solver.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Specify that solutions should be generated using a backwards step-wise
heuristic algorithm (inspired by Cabeza <em>et al.</em> 2004,
Korte &amp; Vygen 2000, Probert <em>et al.</em> 2016). Ideally,
solutions should be generated using exact algorithm solvers (e.g.
<code><a href="add_rsymphony_solver.html">add_rsymphony_solver()</a></code> or <code><a href="add_gurobi_solver.html">add_gurobi_solver()</a></code>)
because they are guaranteed to identify optimal solutions (Rodrigues &amp; Gaston
2002).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_heuristic_solver</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  number_solutions <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  initial_sweep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><a href="ProjectProblem-class.html">ProjectProblem</a> object.</p></dd>


<dt>number_solutions</dt>
<dd><p><code>integer</code> number of solutions desired.
Defaults to 1. Note that the number of returned solutions can sometimes
be less than the argument to <code>number_solutions</code> depending on the
argument to <code>solution_pool_method</code>, for example if 100
solutions are requested but only 10 unique solutions exist, then only 10
solutions will be returned.</p></dd>


<dt>initial_sweep</dt>
<dd><p><code>logical</code> value indicating if projects and
actions which exceed the budget should be automatically excluded
prior to running the backwards heuristic. This step prevents
projects which exceed the budget, and so would never be selected in
the final solution, from biasing the cost-sharing calculations.
However, previous algorithms for project prioritization have not
used this step (e.g. Probert <em>et al.</em> 2016).
Defaults to <code>TRUE</code>.</p></dd>


<dt>verbose</dt>
<dd><p><code>logical</code> should information be printed while solving
optimization problems?</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><a href="ProjectProblem-class.html">ProjectProblem</a> object with the solver added
to it.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The heuristic algorithm used to generate solutions is described
below. It is heavily inspired by the cost-sharing backwards heuristic
algorithm conventionally used to guide the prioritization of species
recovery projects (Probert <em>et al.</em> 2016).</p>
<ol><li><p>All actions and projects are initially selected for funding.</p></li>
<li><p>A set of rules are then used to deselect actions and projects
based on locked constraints (if any). Specifically, (i) actions which are
which are locked out are deselected, and (ii) projects which are
associated with actions that are locked out are also deselected.</p></li>
<li><p>If the argument to <code>initial_sweep</code> is <code>TRUE</code>, then a set of
rules are then used to deselect actions and projects
based on budgetary constraints (if present). Specifically, (i) actions
which exceed the budget are deselected, (ii) projects which are
associated with a set of actions that exceed the budget are deselected,
and (iii) actions which are not associated with any project (excepting
locked in actions) are also deselected.</p></li>
<li><p>If the objective function is to maximize biodiversity subject
to budgetary constraints (e.g. <code><a href="add_max_richness_objective.html">add_max_richness_objective()</a></code>)
then go to step 5. Otherwise, if the objective is to minimize cost
subject to biodiversity constraints (i.e.
<code><a href="add_min_set_objective.html">add_min_set_objective()</a></code>) then go to step 7.</p></li>
<li><p>The next step is repeated until (i) the number of desired
solutions is obtained, and (ii) the total cost of the remaining
actions that are selected for funding is within the budget. After both of
these conditions are met, the algorithm is terminated.</p></li>
<li><p>Each of the remaining projects that are currently selected for
funding are evaluated according to how much the performance of the
solution decreases when the project is deselected for funding, relative to
the cost of the project not shared by other remaining projects. This can
be expressed mathematically as:</p>
<p>$$B_j = \frac{V(J) - V(J - j)}{C_j}$$</p>
<p>Where \(J\) is the set of remaining projects currently
selected for funding (indexed by \(j\)), \(B_j\) is the benefit
associated with funding project \(j\), \(V(J)\) is the objective
value associated with the solution where all remaining projects are
funded, \(V(J - j)\) is the objective value associated with the
solution where all remaining projects except for project \(j\) are
funded, and \(C_j\) is the sum cost of all of the actions
associated with project \(j\)---excluding locked in actions---with the
cost of each action divided by the total number of remaining
projects that share the action (e.g. if two projects both share a $100
action, then this action contributes $50 to the overall cost of each
project).</p>
<p>The project with the smallest benefit (i.e. \(B_j\) value) is then
deselected for funding. In cases where multiple projects have
the same benefit (\(B_j\)) value, the project with the greatest overall
cost (including actions which are shared among multiple remaining
projects) is deselected.</p></li>
<li><p>The next step is repeated until (i) the number of desired
solutions is obtained or (ii) no action can be deselected for funding
without the probability of any feature expecting to persist falling below
its target probability of persistence. After one or both of
these conditions are met, the algorithm is terminated.</p></li>
<li><p>Each of the remaining projects that are currently selected for
funding are evaluated according to how much the performance of the
solution decreases when the project is deselected for funding, relative to
the cost of the project not shared by other remaining projects. This can
be expressed mathematically as:</p>
<p>$$B_j = \frac{\big(\sum_{f}^{F} P_f(J) - T_f \big) -
   \big( \sum_{f}^{F} P_f(J - j) - T_f \big)}{C_j}$$</p>
<p>Where \(F\) is the set of features (indexed by \(f\)),
\(T_f\) is the target for feature \(f\), \(P\) is the set of
remaining projects that are selected for funding (indexed by \(j\)),
\(C_j\) is the cost of all of the actions
associated with project \(j\)---excluding locked in actions---and
accounting for shared costs among remaining projects (e.g. if two
projects both share a $100 action, then this action contributes $50 to
the overall cost of each project), \(B_p\) is the benefit
associated with funding project \(p\), \(P(J)\) is probability
that each feature is expected to persist when the remaining projects
(\(J\)) are funded, and \(P(J - j)\) is the probability that
each feature is expected to persist when all the remaining projects except
for action \(j\) are funded.</p>
<p>The project with the smallest benefit (i.e. \(B_j\) value) is then
deselected for funding. In cases where multiple projects have
the same \(B_j\) value, the project with the greatest overall cost
(including actions which are shared among multiple remaining projects)
is deselected.</p></li>
</ol></div>
    <div id="references">
    <h2>References</h2>
    <p>Rodrigues AS &amp; Gaston KJ (2002) Optimisation in reserve selection
procedures---why not? <em>Biological Conservation</em>, <strong>107</strong>,
123--129.</p>
<p>Cabeza M, Araujo MB, Wilson RJ, Thomas CD, Cowley MJ &amp; Moilanen A (2004)
Combining probabilities of occurrence with spatial reserve design.
<em>Journal of Applied Ecology</em>, <strong>41</strong>, 252--262.</p>
<p>Korte B &amp; Vygen J (2000)
<em>Combinatorial Optimization. Theory and Algorithms</em>. Springer-Verlag,
Berlin, Germany.</p>
<p>Probert W, Maloney RF, Mellish B, and Joseph L (2016)
Project Prioritisation Protocol (PPP).
Formerly available at <a href="https://github.com/p-robot" class="external-link">https://github.com/p-robot</a>
(copy available at <a href="https://github.com/jeffreyhanson/ppp" class="external-link">https://github.com/jeffreyhanson/ppp</a>).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="solvers.html">solvers</a>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># load ggplot2 package for making plots</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim_projects</span>, <span class="va">sim_features</span>, <span class="va">sim_actions</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># build problem with heuristic solver and $200</span></span></span>
<span class="r-in"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_projects</span>, <span class="va">sim_actions</span>, <span class="va">sim_features</span>,</span></span>
<span class="r-in"><span>             <span class="st">"name"</span>, <span class="st">"success"</span>, <span class="st">"name"</span>, <span class="st">"cost"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="add_max_richness_objective.html">add_max_richness_objective</a></span><span class="op">(</span>budget <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>     <span class="fu">add_heuristic_solver</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print problem</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Project Prioritization Problem</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   actions          F1_action, F2_action, F3_action, ... (6 actions)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   projects         F1_project, F2_project, F3_project, ... (6 projects)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   features         F1, F2, F3, ... (5 features)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   action costs:    min: 0, max: 103.22583</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   project success: min: 0.81379, max: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   objective:       Maximum richness objective [budget (200)]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   targets:         none</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   weights:         default</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   decisions        Binary decision </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   constraints:     &lt;none&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   solver:          Heuristic [initial_sweep (1), number_solutions (1), verbose (1)]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># solve problem</span></span></span>
<span class="r-in"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print solution</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 21</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   solution status   obj  cost F1_action F2_act…¹ F3_ac…² F4_ac…³ F5_ac…⁴ basel…⁵</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>        1 <span style="color: #BB0000;">NA</span>      2.19  195.         1        1       0       0       0       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 11 more variables: F1_project &lt;dbl&gt;, F2_project &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   F3_project &lt;dbl&gt;, F4_project &lt;dbl&gt;, F5_project &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   baseline_project &lt;dbl&gt;, F1 &lt;dbl&gt;, F2 &lt;dbl&gt;, F3 &lt;dbl&gt;, F4 &lt;dbl&gt;, F5 &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   and abbreviated variable names ¹​F2_action, ²​F3_action, ³​F4_action,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   ⁴​F5_action, ⁵​baseline_action</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot solution</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">s1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_heuristic_solver-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph R Bennett</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

